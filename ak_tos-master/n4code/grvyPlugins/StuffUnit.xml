<?xml version="1.0" encoding="UTF-8"?>
<argo:snx xmlns:argo="http://www.navis.com/argo" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.navis.com/argo snx.xsd">
<digital-asset id="StuffUnit" short-description="GroovyStuffUnit" groovy-code="import com.navis.apex.business.model.GroovyInjectionBase&#xA;import com.navis.argo.business.atoms.EventEnum&#xA;import com.navis.argo.business.atoms.LocTypeEnum&#xA;import com.navis.argo.business.model.CarrierVisit&#xA;import com.navis.argo.business.reference.*&#xA;import com.navis.inventory.business.units.*&#xA;import com.navis.framework.util.BizViolation&#xA;&#xA;class StuffUnit extends GroovyInjectionBase {&#xA;&#x9;public String execute(Map inParameters) {&#xA;&#xA;&#x9;def ctrId = (String) inParameters.get(&quot;equipment-id&quot;);&#xA;try {&#xA;&#x9;def recorder = (String) inParameters.get(&quot;recorder&quot;);&#xA;&#xA;&#x9;// Find the empty UFV&#xA;&#x9;def emptyUfv = findActiveUfv(ctrId);&#xA;&#x9;if( emptyUfv == null)&#xA;            fail((new StringBuilder()).append(&quot;ERR_GVY_STUFF_001. Could not find Active UFV for &quot;).append(ctrId).toString());&#xA;&#x9;// Stuff it, and get back the new full UFV and Unit&#xA;&#x9;def stuffedUfv = null;&#xA;&#x9;def strippedUfv = null;&#xA;&#x9;def action = &quot;&quot;;&#xA;&#xA;&#x9;try {&#xA;&#x9;&#x9;action = &quot;stuff &quot;;&#xA;&#x9;&#x9;stuffedUfv = stuffUfv(emptyUfv, null);&#xA;&#x9;} catch ( BizViolation ex) {&#xA;&#x9;&#x9;try {&#xA;&#x9;&#x9;&#x9;action = &quot;stuff or strip &quot;;&#xA;&#xA;&#x9;&#x9;&#x9;// check if the commodity id is ok.&#xA;&#x9;&#x9;&#x9;def ufvUnit = emptyUfv.getUfvUnit();&#xA;&#x9;&#x9;&#x9;if ( ufvUnit.isStorageEmpty())&#xA;&#x9;&#x9;&#x9;&#x9;fail((new StringBuilder()).append(&quot;ERR_GVY_STUFF_002. Could not STRIP EMPTY unit: &quot;).append(ctrId).toString());&#xA;&#x9;&#x9;&#x9;def stripGoods = ufvUnit.getUnitGoods();&#xA;&#x9;&#x9;&#x9;if ( stripGoods != null) {&#xA;&#x9;&#x9;&#x9;&#x9;def stripComm = stripGoods.getGdsCommodity();&#xA;&#x9;&#x9;&#x9;&#x9;if ( stripComm != null) {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;def commId = stripComm.getCmdyShortName();&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;if ( commId.length() &lt; 3)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;fail((new StringBuilder()).append(&quot;ERR_GVY_STUFF_003. Could not STRIP unit: &quot;).append(ctrId).append(&quot; with COMMODITY code: &quot;).append(commId).toString());&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;if ( !commId.substring(0, 3).equalsIgnoreCase( &quot;AUT&quot;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;|| !commId.substring(0, 3).equalsIgnoreCase( &quot;CFS&quot;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;|| !commId.substring(0, 3).equalsIgnoreCase( &quot;COB&quot;)) {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;fail((new StringBuilder()).append(&quot;ERR_GVY_STUFF_003. Could not STRIP unit: &quot;).append(ctrId).append(&quot; with COMMODITY code: &quot;).append(commId).toString());&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;&#x9;strippedUfv = stripUfvAndRecordEvent( emptyUfv, null, &quot;JF&quot;);&#xA;&#x9;&#x9;&#x9;def strippedUnit = strippedUfv.getUfvUnit();&#xA;&#x9;&#x9;&#x9;action = &quot;strip then stuff again &quot;;&#xA;&#x9;&#x9;&#x9;// record strip event.&#xA;&#x9;&#x9;&#x9;//strippedUnit.recordUnitEvent(EventEnum.UNIT_STRIP, null, &quot;Stripped by &quot; + recorder);&#xA;&#x9;&#x9;&#x9;stuffedUfv = stuffUfv( strippedUfv, null);&#xA;&#x9;&#x9;} catch ( BizViolation ex1) {&#xA;&#x9;&#x9;&#x9;fail((new StringBuilder()).append(&quot;ERR_GVY_STUFF_004. Could not &quot;).append(action).append(ctrId).toString());&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;&#xA;&#x9;def stuffedUnit = stuffedUfv.getUfvUnit();&#xA;&#x9;// Update the routing&#xA;&#x9;def carrierModeId = (String) inParameters.get(&quot;routing-carrier-mode&quot;);&#xA;&#x9;def carrierId = (String) inParameters.get(&quot;routing-carrier-id&quot;);&#xA;&#x9;def pod1Id = (String) inParameters.get(&quot;routing-pod-1&quot;);&#xA;&#x9;def polId = (String) inParameters.get(&quot;routing-pol&quot;);&#xA;&#x9;def destination = (String) inParameters.get(&quot;routing-destination&quot;);&#xA;&#x9;def carrierMode = LocTypeEnum.getEnum( carrierModeId);&#xA;&#x9;def obCarrier = CarrierVisit.findCarrierVisit(getFacility(), carrierMode, carrierId);&#xA;&#x9;if ( obCarrier == null)&#xA;&#x9;&#x9;fail((new StringBuilder()).append(&quot;ERR_GVY_STUFF_005. Could not find Carrier for &quot;).append(ctrId).toString());&#xA;&#x9;stuffedUfv.updateObCv(obCarrier);&#xA;&#x9;def routing = stuffedUnit.getUnitRouting();&#xA;&#x9;if ( routing == null)&#xA;&#x9;&#x9;fail((new StringBuilder()).append(&quot;ERR_GVY_STUFF_006. Could not find Routing for &quot;).append(ctrId).toString());&#xA;&#xA;&#x9;routing.setRtgDeclaredCv(obCarrier);&#xA;&#x9;if ( pod1Id != null)&#xA;&#x9;&#x9;routing.setRtgPOD1(RoutingPoint.findRoutingPoint(pod1Id));&#xA;&#x9;if ( polId != null)&#xA;&#x9;&#x9;routing.setRtgPOL(RoutingPoint.findRoutingPoint(polId));&#xA;&#x9;stuffedUnit.updateUnitRouting(routing);&#xA;&#x9;GoodsBase goods = stuffedUnit.getUnitGoods();&#xA;&#x9;if ( destination != null)&#xA;&#x9;&#x9;goods.setGoodsDestination(destination);&#xA;&#x9;// update other info&#xA;&#x9;def sealNum = (String) inParameters.get(&quot;seal-1&quot;);&#xA;&#x9;def consigneeId = (String) inParameters.get(&quot;consignee-id&quot;);&#xA;&#x9;def consigneeName = (String) inParameters.get(&quot;consignee-name&quot;);&#xA;&#x9;def shipperId = (String) inParameters.get(&quot;shipper-id&quot;);&#xA;&#x9;def shipperName = (String) inParameters.get(&quot;shipper-name&quot;);&#xA;&#x9;def remark = (String) inParameters.get(&quot;remark&quot;);&#xA;&#x9;def oogBack = (String) inParameters.get(&quot;oog-back&quot;);&#xA;&#x9;def oogFront = (String) inParameters.get(&quot;oog-front&quot;);&#xA;&#x9;def oogLeft = (String) inParameters.get(&quot;oog-left&quot;);&#xA;&#x9;def oogRight = (String) inParameters.get(&quot;oog-right&quot;);&#xA;&#x9;def oogHeight = (String) inParameters.get(&quot;oog-height&quot;);&#xA;&#x9;def commodityId = (String) inParameters.get(&quot;commodity-id&quot;);&#xA;&#x9;def commodityName = (String) inParameters.get(&quot;commodity-name&quot;);&#xA;&#x9;def weight = (String) inParameters.get(&quot;unit-gross-weight&quot;);&#xA;&#xA;&#x9;if ( sealNum != null)&#xA;&#x9;&#x9;stuffedUnit.setUnitSealNbr1( sealNum);&#xA;&#x9;if ( shipperId != null || shipperName != null) {&#xA;&#x9;&#x9;Shipper shipper = Shipper.findOrCreateShipper(shipperId, shipperName);&#xA;&#x9;&#x9;goods.setGdsShipperBzu(shipper);&#xA;&#x9;}&#xA;&#x9;if ( consigneeId != null || consigneeName != null) {&#xA;&#x9;&#x9;Shipper consignee = Shipper.findOrCreateShipper(consigneeId, consigneeName);&#xA;&#x9;&#x9;goods.setGdsConsigneeBzu(consignee);&#xA;&#x9;}&#xA;&#x9;if ( weight != null)&#xA;&#x9;&#x9;stuffedUnit.updateGoodsAndCtrWtKg( new Double(weight));&#xA;&#xA;&#x9;stuffedUnit.updateRemarks(remark);&#xA;&#x9;if ( oogBack != null &amp;&amp; oogFront != null &amp;&amp; oogLeft != null &amp;&amp; oogRight != null &amp;&amp; oogHeight != null)&#xA;&#x9;&#x9;stuffedUnit.updateOog( new Integer(oogBack), new Integer(oogFront), new Integer(oogLeft), new Integer(oogRight), new Integer(oogHeight));&#xA;&#xA;&#x9;//def cmdity = Commodity.findCommodity( &quot;AUTO&quot;);&#xA;&#x9;//stuffedUnit.updateCommodity( cmdity);&#xA;&#xA;&#x9;if ( commodityId != null) {&#xA;&#x9;&#x9;def unitComm = Commodity.findOrCreateCommodity(commodityId);&#xA;&#x9;&#x9;//def unitGoods = stuffedUnit.getUnitGoods();&#xA;&#x9;&#x9;unitComm.setCmdyShortName( commodityName);&#xA;&#x9;&#x9;goods.setGdsCommodity(unitComm);&#xA;&#x9;}&#xA;&#xA;&#x9;// Update the hazardous info&#xA;&#x9;//def hazardItem = stuffedUnit.getUnitGoods().attachHazard(&quot;3&quot;, &quot;1203&quot;)&#xA;&#x9;//hazardItem.setHzrdiPageNumber(&quot;52&quot;);&#xA;&#x9;// Record an event&#xA;&#x9;stuffedUnit.recordUnitEvent(EventEnum.UNIT_STUFF, null, &quot;Stuffed by &quot; + recorder);&#xA;&#x9;return &quot;done via Groovy, unit is: &quot; + stuffedUnit;&#xA;} catch ( Exception ex) {&#xA;&#x9;fail((new StringBuilder()).append(ex.toString()).append(&quot;ERR_GVY_STUFF_999. Could not STUFF unit: &quot;).append(ctrId).toString());&#xA;}&#xA;}&#xA;}" />
</argo:snx>

